<script>
  let userId = "";

  // รอให้ LIFF พร้อมก่อน
  window.onload = function () {
    liff.init({ liffId: "2007665564-bRQjorX0" })
      .then(() => {
        if (!liff.isInClient()) {
          alert("กรุณาเปิดหน้านี้จากในแอป LINE เท่านั้นค่ะ");
          return;
        }

        return liff.getProfile();
      })
      .then(profile => {
        if (profile) userId = profile.userId;
      })
      .catch(err => {
        alert("เกิดข้อผิดพลาดกับ LIFF: " + err);
      });
  };

  // จัดการเมื่อผู้ใช้กด submit
  document.getElementById("registerForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const name = document.getElementById("name").value;
    const phone = document.getElementById("phone").value;

    if (!userId) {
      alert("ไม่สามารถดึง LINE ID ได้ กรุณาเปิดจากในแอป LINE");
      return;
    }

    fetch("https://<YOUR_BACKEND_URL>/webhook", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, phone, user_id: userId })
    })
    .then(res => res.ok ? alert("✅ สมัครเรียบร้อยแล้วค่ะ") : alert("❌ สมัครไม่สำเร็จ"))
    .catch(() => alert("❌ ไม่สามารถส่งข้อมูลได้"));
  });
</script>
